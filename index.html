<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemå®¶å±ä¸“å±-æ™ºèƒ½ç‰¹è®­App</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --warning: #f39c12; --bg: #f8f9fa; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        
        /* çŠ¶æ€æ˜¾ç¤ºæ  */
        .header { width: 95%; max-width: 400px; margin-bottom: 10px; }
        #progress-tag { background: white; padding: 10px; border-radius: 15px; font-size: 13px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; line-height: 1.5; color: #666; }
        #timer-msg { color: #e67e22; font-weight: bold; text-align: center; margin-top: 5px; height: 20px; font-size: 14px; }

        /* å¡ç‰‡è®¾è®¡ */
        .card { background: white; border-radius: 30px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; min-height: 480px; display: flex; flex-direction: column; justify-content: space-between; position: relative; }
        .hint-area { font-size: 70px; margin: 10px 0; }
        .chinese-hint { font-size: 32px; color: #2c3e50; font-weight: bold; }
        .ipa { font-size: 20px; color: #7f8c8d; margin-bottom: 10px; font-family: "Lucida Sans Unicode", sans-serif; }
        
        /* è¾“å…¥ä¸åé¦ˆ */
        .quiz-word { font-size: 36px; letter-spacing: 5px; color: var(--primary); font-weight: bold; min-height: 50px; }
        input { font-size: 26px; padding: 15px; width: 85%; border: 3px solid #eee; border-radius: 15px; text-align: center; outline: none; transition: 0.3s; background: #fafafa; }
        input:focus { border-color: var(--primary); background: white; }
        input.correct { border-color: var(--success); background-color: #f0fff4; }

        .sentence { font-size: 18px; color: #444; background: #f1f7ff; padding: 15px; border-radius: 15px; margin-top: 15px; line-height: 1.4; border-left: 5px solid var(--primary); text-align: left; }

        /* æŒ‰é’® */
        .btn { padding: 18px; border: none; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: bold; margin: 5px; color: white; transition: 0.2s; }
        .btn-audio { background: #9b59b6; flex: 1; }
        .btn-audio:active { transform: scale(0.95); }
        .btn-flip { background: var(--primary); width: 100%; }
        .btn-next { background: var(--success); width: 100%; display: none; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3); }
        
        button:disabled { background: #ccc !important; cursor: not-allowed; transform: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <div id="progress-tag">æ­£åœ¨åŒæ­¥ç¬”è®°è¿›åº¦...</div>
        <div id="timer-msg"></div>
    </div>

    <div class="card">
        <div id="front-side">
            <div class="hint-area" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <p style="color:#999; font-size:14px;">è§‚å¯Ÿå›¾æ ‡å’Œä¸­æ–‡ï¼Œå‡†å¤‡å¥½åç‚¹å‡»ä¸‹æ–¹æŒ‰é’®</p>
            <button class="btn btn-flip" id="flip-btn" onclick="showBack()">ğŸ”„ æŒ‘æˆ˜æ‹¼å†™</button>
        </div>

        <div id="back-side" style="display:none">
            <div class="ipa" id="ipa-display"></div>
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¯·è¾“å…¥å•è¯" autocomplete="off" oninput="checkInput(event)">
            
            <div id="sentence-box" class="sentence"></div>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button class="btn btn-audio" onclick="speak('en-GB')">ğŸ‡¬ğŸ‡§ è‹±éŸ³</button>
                <button class="btn btn-audio" onclick="speak('en-US')">ğŸ‡ºğŸ‡¸ ç¾éŸ³</button>
            </div>
        </div>

        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ æ‹¼å¯¹äº†ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // ã€è¯åº“åŒºã€‘ç”±Gemçš„ç¬”è®°æç‚¼ã€‚priority:true çš„å•è¯æ¯å¤©éƒ½ä¼šå‡ºç°ï¼Œç›´åˆ°å®Œå…¨æŒæ¡
        const originalLib = [
            // é‡ç‚¹å¿…è€ƒè¯ (Priority)
            { en: "What", ipa: "/wÉ’t/", cn: "ä»€ä¹ˆ", icon: "â“", sentence: "What is this?", priority: true },
            { en: "How", ipa: "/haÊŠ/", cn: "æ€æ ·", icon: "ğŸ› ï¸", sentence: "How are you?", priority: true },
            { en: "Can", ipa: "/kÃ¦n/", cn: "èƒ½/å¯ä»¥", icon: "ğŸ’ª", sentence: "I can sing.", priority: true },
            { en: "In", ipa: "/Éªn/", cn: "åœ¨...é‡Œ", icon: "ğŸ“¦", sentence: "It is in the box.", priority: true },
            { en: "On", ipa: "/É’n/", cn: "åœ¨...ä¸Š", icon: "ğŸ”", sentence: "It is on the desk.", priority: true },
            { en: "Under", ipa: "/ËˆÊŒndÉ™/", cn: "åœ¨...ä¸‹", icon: "ğŸ‘‡", sentence: "It is under the chair.", priority: true },
            { en: "With", ipa: "/wÉªÃ°/", cn: "å’Œ...ä¸€èµ·", icon: "ğŸ‘«", sentence: "Play with me.", priority: true },
            
            // åŸºç¡€å·©å›ºè¯
            { en: "Read", ipa: "/riËd/", cn: "è¯»", icon: "ğŸ“–", sentence: "I read a book." },
            { en: "Write", ipa: "/raÉªt/", cn: "å†™", icon: "âœï¸", sentence: "Write your name." },
            { en: "Hand", ipa: "/hÃ¦nd/", cn: "æ‰‹", icon: "âœ‹", sentence: "I have two hands." },
            { en: "Eye", ipa: "/aÉª/", cn: "çœ¼ç›", icon: "ğŸ‘ï¸", sentence: "She has big eyes." },
            { en: "Good", ipa: "/É¡ÊŠd/", cn: "å¥½çš„", icon: "ğŸ‘", sentence: "You are a good boy." },
            { en: "Small", ipa: "/smÉ”Ël/", cn: "å°çš„", icon: "ğŸ–±ï¸", sentence: "It is a small toy." }
        ];

        // --- æ ¸å¿ƒé€»è¾‘å¼•æ“ ---
        let wordProgress = JSON.parse(localStorage.getItem('gem_final_v1')) || {};
        originalLib.forEach(w => {
            if (!wordProgress[w.en]) wordProgress[w.en] = { level: 0, lastDate: 0 };
        });

        // ç­›é€‰ä»Šæ—¥ä»»åŠ¡
        const oneDay = 24 * 60 * 60 * 1000;
        let todayLib = originalLib.filter(w => {
            if (w.priority) return true;
            let p = wordProgress[w.en];
            const now = Date.now();
            if (p.level === 0) return true;
            if (p.level === 1 && now - p.lastDate > oneDay) return true;
            if (p.level === 2 && now - p.lastDate > 6 * oneDay) return true;
            return false;
        });

        // ä¼˜å…ˆçº§æ’åºï¼šé‡ç‚¹è¯æ°¸è¿œæ’åœ¨ç¬¬ä¸€ä½
        todayLib.sort((a, b) => (b.priority ? 1 : 0) - (a.priority ? 1 : 0));

        let currentPool = todayLib.length > 0 ? [...todayLib] : [];
        let wrongWords = [];
        let index = 0;
        let hasLooked = false;

        function lock() {
            const fb = document.getElementById('flip-btn');
            fb.disabled = true;
            let c = 3;
            const tm = document.getElementById('timer-msg');
            const t = setInterval(() => {
                c--;
                if(c>0) tm.innerText = `â³ è¯·è§‚å¯Ÿæ€è€ƒ (${c}s)`;
                else { tm.innerText = "âœ… æ€è€ƒç»“æŸï¼Œè¯·æŒ‘æˆ˜"; fb.disabled = false; clearInterval(t); }
            }, 1000);
        }

        function showBack() {
            hasLooked = true; // åªè¦ç¿»è½¬çœ‹ç­”æ¡ˆï¼Œå°±è§†ä¸ºéœ€åœ¨æœ¬è½®æœ«å°¾é‡æ–°ç»ƒä¹ 
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function checkInput(e) {
            if (e.target.value.toLowerCase().trim() === currentPool[index].en.toLowerCase()) {
                e.target.classList.add('correct');
                document.getElementById('next-btn').style.display = 'block';
                speak('en-GB');
            } else {
                e.target.classList.remove('correct');
                document.getElementById('next-btn').style.display = 'none';
            }
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                // å¦‚æœçœ‹äº†æç¤ºï¼Œè¿›é”™é¢˜æœ¬ï¼Œä¸”è®°å¿†ç­‰çº§å½’é›¶
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
                wordProgress[currentWord].level = 0;
            } else {
                // ç‹¬ç«‹æ‹¼å¯¹ï¼Œç­‰çº§æå‡
                wordProgress[currentWord].level += 1;
                wordProgress[currentWord].lastDate = Date.now();
            }
            localStorage.setItem('gem_final_v1', JSON.stringify(wordProgress));

            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    alert(`ç¬¬ä¸€è½®ç»“æŸã€‚åˆšæ‰çœ‹æç¤ºçš„ ${wrongWords.length} ä¸ªè¯éœ€è¦é‡æ–°ç»ƒä¹ ã€‚`);
                    currentPool = [...wrongWords];
                    wrongWords = [];
                    index = 0;
                } else {
                    alert("ğŸ‰ å¤ªæ£’äº†ï¼ŒGemï¼ä»Šå¤©çš„å­¦ä¹ ä»»åŠ¡å…¨éƒ¨é€šå…³ï¼");
                    location.reload();
                    return;
                }
            }
            render();
        }

        function speak(lang) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(currentPool[index].en);
            u.lang = lang; u.rate = 0.75; // è¯­é€Ÿç¨æ…¢ï¼Œé€‚åˆå­©å­æ¨¡ä»¿
            window.speechSynthesis.speak(u);
        }

        function render() {
            if (currentPool.length === 0) {
                document.body.innerHTML = "<div class='card' style='justify-content:center'><h1>ğŸŒŸ ä»»åŠ¡åœ†æ»¡å®Œæˆ</h1><p style='color:#666'>ä»Šå¤©æ²¡æœ‰å¾…å¤ä¹ çš„è¯äº†ã€‚<br>æ˜å¤©å†æ¥å§ï¼ŒGemï¼</p></div>";
                return;
            }
            const item = currentPool[index];
            hasLooked = false;
            
            document.getElementById('progress-tag').innerHTML = 
                `<b>ä»Šæ—¥å‰©ä½™ï¼š</b>${currentPool.length - index} ä¸ª <br>` +
                `<b>é”™é¢˜æœ¬å¾…æ¶ˆç­ï¼š</b>${wrongWords.length} ä¸ª`;
            
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ipa || "";
            document.getElementById('sentence-box').innerText = item.sentence || "";
            
            // æ‹¼å†™æç¤ºï¼šæ˜¾ç¤ºé¦–å°¾å­—æ¯
            document.getElementById('word-hint').innerText = 
                item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            
            const input = document.getElementById('wordInput');
            input.value = "";
            input.classList.remove('correct');
            
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            
            lock();
        }

        window.onload = render;
    </script>
</body>
</html>



