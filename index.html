<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemå®¶å±ä¸“å±-å…¨åŠŸèƒ½ç‰¹è®­App</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --bg: #f8f9fa; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .header { width: 95%; max-width: 400px; margin-bottom: 10px; }
        #progress-tag { background: white; padding: 10px; border-radius: 15px; font-size: 13px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; line-height: 1.5; color: #666; }
        #timer-msg { color: #e67e22; font-weight: bold; text-align: center; margin-top: 5px; height: 20px; font-size: 14px; }
        .card { background: white; border-radius: 30px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; min-height: 520px; display: flex; flex-direction: column; justify-content: space-between; }
        .hint-area { font-size: 70px; margin: 10px 0; }
        .chinese-hint { font-size: 32px; color: #2c3e50; font-weight: bold; }
        .ipa { font-size: 18px; color: #7f8c8d; margin-bottom: 5px; }
        .quiz-word { font-size: 32px; letter-spacing: 5px; color: var(--primary); font-weight: bold; min-height: 45px; }
        input { font-size: 24px; padding: 12px; width: 85%; border: 3px solid #eee; border-radius: 12px; text-align: center; outline: none; transition: 0.3s; }
        input.wrong { border-color: var(--error); background-color: #fff5f5; animation: shake 0.3s; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        .sentence-container { display: flex; align-items: center; background: #f1f7ff; padding: 12px; border-radius: 15px; margin-top: 15px; border-left: 5px solid var(--primary); text-align: left; }
        .sentence-text { font-size: 16px; color: #444; flex: 1; margin-right: 8px; line-height: 1.4; }
        .btn-speak-sentence { background: var(--primary); color: white; border: none; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .btn { padding: 16px; border: none; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: bold; margin: 5px; color: white; }
        .btn-audio { background: #9b59b6; flex: 1; }
        .btn-flip { background: var(--primary); width: 100%; }
        .btn-submit { background: #34495e; width: 100%; margin-top: 10px; }
        .btn-next { background: var(--success); width: 100%; margin-top: 10px; display: none; }
        button:disabled { background: #ccc !important; }
    </style>
</head>
<body>

    <div class="header">
        <div id="progress-tag">åŒæ­¥ç¬”è®°ä¸­...</div>
        <div id="timer-msg"></div>
    </div>

    <div class="card">
        <div id="front-side">
            <div class="hint-area" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <button class="btn btn-flip" id="flip-btn" onclick="showBack()">ğŸ”„ æŒ‘æˆ˜æ‹¼å†™</button>
        </div>

        <div id="back-side" style="display:none">
            <div class="ipa" id="ipa-display"></div>
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¾“å…¥å•è¯åæäº¤" autocomplete="off" spellcheck="false">
            <div class="sentence-container">
                <div id="sentence-box" class="sentence-text"></div>
                <button class="btn-speak-sentence" onclick="speakSentence()">ğŸ”Š</button>
            </div>
            <div style="margin-top:15px; display:flex; gap:10px;">
                <button class="btn btn-audio" onclick="speakWord('en-GB')">ğŸ‡¬ğŸ‡§ è‹±éŸ³</button>
                <button class="btn btn-audio" onclick="speakWord('en-US')">ğŸ‡ºğŸ‡¸ ç¾éŸ³</button>
            </div>
            <button id="submit-btn" class="btn btn-submit" onclick="submitAnswer()">ç¡®è®¤æäº¤</button>
        </div>
        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ æ­£ç¡®ï¼ç»§ç»­ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // --- å…¨é‡æ•´åˆè¯åº“ï¼ˆGemç¬”è®°å†…å®¹ï¼‰ ---
        const originalLib = [
            // ç¬¬ä¸€éƒ¨åˆ†ï¼šé«˜é¢‘å¿…è€ƒè¯ (Priority)
            { en: "What", ipa: "/wÉ’t/", cn: "ä»€ä¹ˆ", icon: "â“", sentence: "What is this?", priority: true },
            { en: "How", ipa: "/haÊŠ/", cn: "æ€æ ·", icon: "ğŸ› ï¸", sentence: "How are you?", priority: true },
            { en: "Can", ipa: "/kÃ¦n/", cn: "èƒ½", icon: "ğŸ’ª", sentence: "I can sing.", priority: true },
            { en: "In", ipa: "/Éªn/", cn: "åœ¨...é‡Œ", icon: "ğŸ“¦", sentence: "It is in the box.", priority: true },
            { en: "On", ipa: "/É’n/", cn: "åœ¨...ä¸Š", icon: "ğŸ”", sentence: "It is on the desk.", priority: true },
            { en: "Under", ipa: "/ËˆÊŒndÉ™/", cn: "åœ¨...ä¸‹", icon: "ğŸ‘‡", sentence: "It is under the chair.", priority: true },
            { en: "With", ipa: "/wÉªÃ°/", cn: "å’Œ...ä¸€èµ·", icon: "ğŸ‘«", sentence: "Play with me.", priority: true },
            { en: "This", ipa: "/Ã°Éªs/", cn: "è¿™ä¸ª", icon: "ğŸ“", sentence: "This is my duck.", priority: true },

            // ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒåŠ¨è¯ä¸åè¯
            { en: "Read", ipa: "/riËd/", cn: "è¯»", icon: "ğŸ“–", sentence: "I read a book." },
            { en: "Write", ipa: "/raÉªt/", cn: "å†™", icon: "âœï¸", sentence: "You write a word." },
            { en: "Draw", ipa: "/drÉ”Ë/", cn: "ç”»", icon: "ğŸ¨", sentence: "I draw a cat." },
            { en: "Listen", ipa: "/ËˆlÉªsn/", cn: "å¬", icon: "ğŸ‘‚", sentence: "We listen to music." },
            { en: "Sing", ipa: "/sÉªÅ‹/", cn: "å”±", icon: "ğŸ¤", sentence: "They sing a song." },
            { en: "Jump", ipa: "/dÊ’ÊŒmp/", cn: "è·³", icon: "ğŸ¦˜", sentence: "I jump up and down." },
            { en: "Hand", ipa: "/hÃ¦nd/", cn: "æ‰‹", icon: "âœ‹", sentence: "I have two hands." },
            { en: "Eye", ipa: "/aÉª/", cn: "çœ¼ç›", icon: "ğŸ‘ï¸", sentence: "She has big eyes." },
            { en: "Mouth", ipa: "/maÊŠÎ¸/", cn: "å˜´", icon: "ğŸ‘„", sentence: "Open your mouth." },
            { en: "Good", ipa: "/É¡ÊŠd/", cn: "å¥½çš„", icon: "ğŸ‘", sentence: "You are a good boy." },
            { en: "Small", ipa: "/smÉ”Ël/", cn: "å°çš„", icon: "ğŸ–±ï¸", sentence: "It is a small toy." }
        ];

        let wordProgress = JSON.parse(localStorage.getItem('gem_final_complete')) || {};
        originalLib.forEach(w => { if (!wordProgress[w.en]) wordProgress[w.en] = { level: 0, lastDate: 0 }; });

        const oneDay = 24 * 60 * 60 * 1000;
        let todayLib = originalLib.filter(w => {
            if (w.priority) return true;
            let p = wordProgress[w.en];
            const now = Date.now();
            if (p.level === 0) return true;
            if (p.level === 1 && now - p.lastDate > oneDay) return true;
            if (p.level === 2 && now - p.lastDate > 6 * oneDay) return true;
            return false;
        });

        todayLib.sort((a, b) => (b.priority ? 1 : 0) - (a.priority ? 1 : 0));
        let currentPool = todayLib.length > 0 ? [...todayLib] : [];
        let wrongWords = [];
        let index = 0;
        let hasLooked = false;

        function lock() {
            const fb = document.getElementById('flip-btn');
            fb.disabled = true;
            let c = 3;
            const tm = document.getElementById('timer-msg');
            const t = setInterval(() => {
                c--;
                if(c>0) tm.innerText = `â³ è§‚å¯Ÿæ€è€ƒä¸­ (${c}s)`;
                else { tm.innerText = "âœ… æ€è€ƒå®Œæˆï¼Œè¯·æŒ‘æˆ˜"; fb.disabled = false; clearInterval(t); }
            }, 1000);
        }

        function showBack() {
            hasLooked = true;
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function submitAnswer() {
            const input = document.getElementById('wordInput');
            const userVal = input.value.toLowerCase().trim();
            const correctVal = currentPool[index].en.toLowerCase();
            if (userVal === correctVal) {
                input.classList.remove('wrong');
                document.getElementById('submit-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'block';
                speakWord('en-GB');
            } else {
                input.classList.add('wrong');
                alert("æ‹¼é”™å•¦ï¼åˆ«æ‹…å¿ƒï¼Œè¿™ä¸ªè¯ä¼šåŠ å…¥é‡ç»ƒæ¸…å•ï¼Œç­‰ä¸‹å†è¯•ä¸€æ¬¡ã€‚");
                hasLooked = true;
            }
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
                wordProgress[currentWord].level = 0;
            } else {
                wordProgress[currentWord].level += 1;
                wordProgress[currentWord].lastDate = Date.now();
            }
            localStorage.setItem('gem_final_complete', JSON.stringify(wordProgress));
            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    alert(`ç¬¬ä¸€è½®ç»“æŸï¼å¼€å§‹é‡ç»ƒåˆšæ‰çš„ ${wrongWords.length} ä¸ªå•è¯ã€‚`);
                    currentPool = [...wrongWords];
                    wrongWords = [];
                    index = 0;
                } else {
                    alert("ğŸ‰ ä»»åŠ¡åœ†æ»¡å®Œæˆï¼");
                    location.reload();
                    return;
                }
            }
            render();
        }

        function speakWord(lang) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(currentPool[index].en);
            u.lang = lang; u.rate = 0.75;
            window.speechSynthesis.speak(u);
        }

        function speakSentence() {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(currentPool[index].sentence);
            u.lang = 'en-US'; u.rate = 0.75;
            window.speechSynthesis.speak(u);
        }

        function render() {
            if (currentPool.length === 0) {
                document.body.innerHTML = "<div class='card' style='justify-content:center'><h1>ğŸŒŸ ä»»åŠ¡å·²å®Œæˆ</h1><p>æ˜å¤©å†æ¥å§ï¼</p></div>";
                return;
            }
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerHTML = `ä»Šæ—¥å¾…å®Œæˆï¼š${currentPool.length - index} | éœ€é‡ç»ƒï¼š${wrongWords.length}`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ipa || "";
            document.getElementById('sentence-box').innerText = item.sentence || "";
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            const input = document.getElementById('wordInput');
            input.value = ""; input.classList.remove('wrong');
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
            lock();
        }
        window.onload = render;
    </script>
</body>
</html>




