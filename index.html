<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemå®¶å±ä¸“å±-å…¨èƒ½è®°å¿†App</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --warning: #f1c40f; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; }
        .card { background: white; border-radius: 25px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; min-height: 450px; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #progress-tag { background: #eee; padding: 8px 12px; border-radius: 15px; font-size: 13px; margin-bottom: 10px; line-height: 1.4; width: 85%; text-align: center; }
        #timer-msg { color: #e67e22; font-weight: bold; margin-bottom: 5px; font-size: 14px; }

        /* å†…å®¹åŒº */
        .hint-area { font-size: 80px; margin: 10px 0; }
        .chinese-hint { font-size: 28px; color: #333; font-weight: bold; }
        
        .ipa { font-size: 18px; color: #666; margin: 5px 0; font-family: sans-serif; }
        .sentence { font-size: 16px; color: #444; background: #f9f9f9; padding: 10px; border-radius: 10px; margin-top: 10px; line-height: 1.4; border-left: 4px solid var(--primary); }

        .quiz-word { font-size: 32px; letter-spacing: 4px; color: var(--primary); font-weight: bold; min-height: 40px; margin: 10px 0; }
        input { font-size: 24px; padding: 12px; width: 85%; border: 3px solid #ddd; border-radius: 12px; text-align: center; outline: none; }
        input.correct { border-color: var(--success); background-color: #f0fff4; }

        /* æŒ‰é’® */
        .btn { padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-size: 17px; font-weight: bold; margin: 5px; color: white; }
        .btn-audio { background: #9b59b6; width: 45%; }
        .btn-flip { background: var(--primary); width: 100%; margin-top: 10px; }
        .btn-next { background: var(--success); width: 100%; margin-top: 10px; display: none; }
        
        button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>

    <div id="progress-tag">åŠ è½½ä¸­...</div>
    <div id="timer-msg">å‡†å¤‡æŒ‘æˆ˜</div>

    <div class="card">
        <div id="front-side">
            <div class="hint-area" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <button class="btn btn-flip" id="flip-btn" onclick="showBack()">ğŸ”„ æŒ‘æˆ˜æ‹¼å†™</button>
        </div>

        <div id="back-side" style="display:none">
            <div class="quiz-word" id="word-hint"></div>
            <div class="ipa" id="ipa-display"></div>
            <input type="text" id="wordInput" placeholder="åœ¨æ­¤è¾“å…¥å•è¯..." oninput="checkInput(event)">
            
            <div id="sentence-box" class="sentence"></div>

            <div style="margin-top:15px; display:flex; justify-content: center;">
                <button class="btn btn-audio" onclick="speak('en-GB')">è‹±éŸ³ ğŸ‡¬ğŸ‡§</button>
                <button class="btn btn-audio" onclick="speak('en-US')">ç¾éŸ³ ğŸ‡ºğŸ‡¸</button>
            </div>
        </div>

        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ æ‹¼å¯¹äº†ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // ã€è¯åº“åŒºã€‘åœ¨è¿™é‡Œä¿®æ”¹å•è¯ã€‚ä¼˜å…ˆçº§å•è¯åŠ  priority: true
        const originalLib = [
            { en: "Apple", ipa: "/ËˆÃ¦pl/", cn: "è‹¹æœ", icon: "ğŸ", sentence: "I eat an apple.", priority: true },
            { en: "Banana", ipa: "/bÉ™ËˆnÉ‘ËnÉ™/", cn: "é¦™è•‰", icon: "ğŸŒ", sentence: "This is a banana.", priority: true },
            { en: "Cat", ipa: "/kÃ¦t/", cn: "çŒ«", icon: "ğŸ±", sentence: "I like my cat." },
            { en: "Dog", ipa: "/dÉ’É¡/", cn: "ç‹—", icon: "ğŸ¶", sentence: "The dog is big." }
        ];

        // --- é€»è¾‘å¤„ç† (Gem å»ºè®®ä¸è¦æ”¹åŠ¨è¿™é‡Œ) ---
        let wordProgress = JSON.parse(localStorage.getItem('gem_smart_v2')) || {};
        originalLib.forEach(w => {
            if (!wordProgress[w.en]) wordProgress[w.en] = { level: 0, lastDate: 0 };
        });

        // ç­›é€‰ä»Šæ—¥ä»»åŠ¡ï¼šä¼˜å…ˆçº§è¯ + åˆ°æœŸè¯
        const oneDay = 24 * 60 * 60 * 1000;
        let todayLib = originalLib.filter(w => {
            if (w.priority) return true;
            let p = wordProgress[w.en];
            const now = Date.now();
            if (p.level === 0) return true;
            if (p.level === 1 && now - p.lastDate > oneDay) return true;
            if (p.level === 2 && now - p.lastDate > 6 * oneDay) return true;
            return false;
        });

        // æ’åºï¼šå¿…è€ƒè¯åœ¨å‰
        todayLib.sort((a, b) => (b.priority ? 1 : 0) - (a.priority ? 1 : 0));

        let currentPool = todayLib.length > 0 ? [...todayLib] : [];
        let wrongWords = [];
        let index = 0;
        let hasLooked = false;

        function lock() {
            const fb = document.getElementById('flip-btn');
            fb.disabled = true;
            let c = 3;
            const tm = document.getElementById('timer-msg');
            const t = setInterval(() => {
                c--;
                if(c>0) tm.innerText = `â³ è§‚å¯Ÿæ€è€ƒ (${c}s)`;
                else { tm.innerText = "âœ… è¯·å¼€å§‹æ‹¼å†™"; fb.disabled = false; clearInterval(t); }
            }, 1000);
        }

        function showBack() {
            hasLooked = true; 
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function checkInput(e) {
            if (e.target.value.toLowerCase().trim() === currentPool[index].en.toLowerCase()) {
                e.target.classList.add('correct');
                document.getElementById('next-btn').style.display = 'block';
                speak('en-GB');
            }
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
                wordProgress[currentWord].level = 0;
            } else {
                wordProgress[currentWord].level += 1;
                wordProgress[currentWord].lastDate = Date.now();
            }
            localStorage.setItem('gem_smart_v2', JSON.stringify(wordProgress));

            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    alert("ç¬¬ä¸€è½®ç»“æŸï¼Œç°åœ¨å¤ä¹ åˆšæ‰çœ‹æç¤ºçš„è¯ã€‚");
                    currentPool = [...wrongWords];
                    wrongWords = [];
                    index = 0;
                } else {
                    alert("ğŸ‰ ä»Šå¤©çš„å­¦ä¹ ç›®æ ‡è¾¾æˆï¼");
                    location.reload();
                    return;
                }
            }
            render();
        }

        function speak(lang) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(currentPool[index].en);
            u.lang = lang; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function render() {
            if (currentPool.length === 0) {
                document.body.innerHTML = "<div class='card'><h1>ğŸŒŸ ä»»åŠ¡å®Œæˆ</h1><p>ä»Šå¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„è¯å•¦ï¼</p></div>";
                return;
            }
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerHTML = `ä»Šæ—¥å‰©ä½™: ${currentPool.length - index} | å¤ä¹ æœ¬: ${wrongWords.length}`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ipa || "";
            document.getElementById('sentence-box').innerText = item.sentence || "";
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            document.getElementById('wordInput').value = "";
            document.getElementById('wordInput').classList.remove('correct');
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            lock();
        }

        window.onload = render;
    </script>
</body>
</html>


