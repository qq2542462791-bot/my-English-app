<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemå®¶å±ä¸“å±-è¶…æ…¢é€Ÿé«˜æ¸…è¯­éŸ³ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --bg: #f8f9fa; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .header { width: 95%; max-width: 400px; margin-bottom: 10px; }
        #progress-tag { background: white; padding: 10px; border-radius: 15px; font-size: 13px; text-align: center; color: #666; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card { background: white; border-radius: 30px; padding: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; min-height: 550px; display: flex; flex-direction: column; justify-content: space-between; }
        .chinese-hint { font-size: 32px; color: #2c3e50; font-weight: bold; margin: 10px 0; }
        .quiz-word { font-size: 32px; letter-spacing: 5px; color: var(--primary); font-weight: bold; min-height: 45px; }
        input { font-size: 24px; padding: 12px; width: 85%; border: 3px solid #eee; border-radius: 12px; text-align: center; outline: none; }
        input.wrong { border-color: var(--error); background: #fff5f5; }
        
        #choice-area { display: none; margin-top: 15px; background: #fff3e0; padding: 15px; border-radius: 15px; border: 2px dashed #ffb74d; }
        .choice-btn { background: white; border: 2px solid #ffb74d; padding: 10px; margin: 5px; border-radius: 10px; font-size: 18px; cursor: pointer; display: inline-block; width: 80%; }
        
        .sentence-container { display: flex; align-items: center; background: #f1f7ff; padding: 10px; border-radius: 12px; margin: 10px 0; text-align: left; }
        .btn-speak { background: var(--primary); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; flex-shrink: 0; font-size: 20px; box-shadow: 0 4px 10px rgba(74,144,226,0.3); }
        .btn { padding: 16px; border: none; border-radius: 15px; cursor: pointer; font-size: 18px; font-weight: bold; color: white; }
        .btn-submit { background: #34495e; width: 100%; margin-top: 10px; }
        .btn-next { background: var(--success); width: 100%; display: none; }
    </style>
</head>
<body>

    <div class="header"><div id="progress-tag">è¯­éŸ³å¼•æ“å·²é‡ç½®...</div><div id="timer-msg" style="text-align:center;color:#e67e22;font-weight:bold;height:20px;"></div></div>

    <div class="card">
        <div id="front-side">
            <div style="font-size:70px;" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <button class="btn" style="background:var(--primary);width:100%" id="flip-btn" onclick="showBack()">ğŸ”„ å‡†å¤‡æŒ‘æˆ˜</button>
        </div>

        <div id="back-side" style="display:none">
            <div id="ipa-display" style="color:#7f8c8d;margin-bottom:5px;"></div>
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¯·è¾“å…¥å•è¯" autocomplete="off" spellcheck="false">
            
            <div id="choice-area">
                <p style="margin:0 0 10px 0; color:#e67e22; font-weight:bold;">åˆ«æ€¥ï¼Œä»ä¸‹é¢æ‰¾å‡ºæ­£ç¡®çš„è¯ï¼š</p>
                <div id="choices-list"></div>
            </div>

            <div class="sentence-container">
                <div id="sentence-box" style="flex:1; font-size:15px; color:#2c3e50; line-height:1.5;"></div>
                <button class="btn-speak" onclick="speak('sentence')">ğŸ”Š</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:#9b59b6;flex:1;" onclick="speak('word-gb')">ğŸ‡¬ğŸ‡§ è‹±</button>
                <button class="btn" style="background:#9b59b6;flex:1;" onclick="speak('word-us')">ğŸ‡ºğŸ‡¸ ç¾</button>
            </div>
            <button id="submit-btn" class="btn btn-submit" onclick="submitAnswer()">ç¡®è®¤æäº¤</button>
        </div>
        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ æ­£ç¡®ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // --- å®Œæ•´è¯åº“åŒæ­¥ ---
        const originalLib = [
            { en: "What", ipa: "/wÉ’t/", cn: "ä»€ä¹ˆ", icon: "â“", sentence: "What is your name?", priority: true },
            { en: "How", ipa: "/haÊŠ/", cn: "æ€æ ·", icon: "ğŸ› ï¸", sentence: "How are you?", priority: true },
            { en: "Where", ipa: "/weÉ™/", cn: "å“ªé‡Œ", icon: "ğŸ“", sentence: "Where is the cat?", priority: true },
            { en: "Who", ipa: "/huË/", cn: "è°", icon: "ğŸ‘¤", sentence: "Who is he?", priority: true },
            { en: "I", ipa: "/aÉª/", cn: "æˆ‘", icon: "ğŸ™‹", sentence: "I am a boy." },
            { en: "You", ipa: "/juË/", cn: "ä½ ", icon: "ğŸ‘‰", sentence: "You are my friend." },
            { en: "He", ipa: "/hiË/", cn: "ä»–", icon: "ğŸ‘¦", sentence: "He is tall." },
            { en: "She", ipa: "/ÊƒiË/", cn: "å¥¹", icon: "ğŸ‘§", sentence: "She is happy." },
            { en: "Behind", ipa: "/bÉªËˆhaÉªnd/", cn: "åœ¨...åé¢", icon: "ğŸ”™", sentence: "He is behind the door.", priority: true },
            { en: "Beside", ipa: "/bÉªËˆsaÉªd/", cn: "åœ¨...æ—è¾¹", icon: "ğŸ”œ", sentence: "Sit beside me.", priority: true },
            { en: "Between", ipa: "/bÉªËˆtwiËn/", cn: "åœ¨...ä¹‹é—´", icon: "â†”ï¸", sentence: "It is between the boxes.", priority: true },
            { en: "Under", ipa: "/ËˆÊŒndÉ™/", cn: "åœ¨...ä¸‹é¢", icon: "ğŸ‘‡", sentence: "Under the tree." },
            { en: "Run", ipa: "/rÊŒn/", cn: "è·‘", icon: "ğŸƒ", sentence: "Run fast!" },
            { en: "Swim", ipa: "/swÉªm/", cn: "æ¸¸æ³³", icon: "ğŸŠ", sentence: "I can swim." },
            { en: "Walk", ipa: "/wÉ”Ëk/", cn: "èµ°", icon: "ğŸš¶", sentence: "Walk to school." },
            { en: "Fly", ipa: "/flaÉª/", cn: "é£", icon: "âœˆï¸", sentence: "Birds can fly." },
            { en: "This", ipa: "/Ã°Éªs/", cn: "è¿™", icon: "ğŸ“", sentence: "This is mine." },
            { en: "That", ipa: "/Ã°Ã¦t/", cn: "é‚£", icon: "ğŸ”­", sentence: "That is yours." },
            { en: "Open", ipa: "/ËˆÉ™ÊŠpÉ™n/", cn: "æ‰“å¼€", icon: "ğŸ‘", sentence: "Open the window." },
            { en: "Close", ipa: "/klÉ™ÊŠz/", cn: "å…³é—­", icon: "ğŸšª", sentence: "Close your eyes." }
        ];

        let wordProgress = JSON.parse(localStorage.getItem('gem_pro_v2')) || {};
        originalLib.forEach(w => { if(!wordProgress[w.en]) wordProgress[w.en] = { level: 0, lastDate: 0 }; });

        let todayLib = originalLib.filter(w => {
            if(w.priority) return true;
            let p = wordProgress[w.en];
            const now = Date.now();
            return p.level === 0 || (p.level === 1 && now - p.lastDate > 86400000);
        }).sort((a,b) => (b.priority ? 1 : 0) - (a.priority ? 1 : 0));

        let currentPool = [...todayLib], wrongWords = [], index = 0, hasLooked = false;

        function showBack() {
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function submitAnswer() {
            const input = document.getElementById('wordInput');
            const userVal = input.value.toLowerCase().trim();
            const correctVal = currentPool[index].en.toLowerCase();
            if (userVal === correctVal) {
                input.classList.remove('wrong');
                document.getElementById('submit-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('choice-area').style.display = 'none';
                speak('word-gb');
            } else {
                input.classList.add('wrong');
                showChoices();
                hasLooked = true;
            }
        }

        function showChoices() {
            const area = document.getElementById('choice-area');
            const list = document.getElementById('choices-list');
            area.style.display = 'block';
            list.innerHTML = "";
            let choices = [currentPool[index].en];
            while(choices.length < 3) {
                let randomWord = originalLib[Math.floor(Math.random()*originalLib.length)].en;
                if(!choices.includes(randomWord)) choices.push(randomWord);
            }
            choices.sort(() => Math.random() - 0.5);
            choices.forEach(c => {
                let btn = document.createElement('button');
                btn.className = "choice-btn";
                btn.innerText = c;
                btn.onclick = () => {
                    document.getElementById('wordInput').value = "";
                    document.getElementById('wordInput').focus();
                };
                list.appendChild(btn);
            });
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
                wordProgress[currentWord].level = 0;
            } else {
                wordProgress[currentWord].level += 1;
                wordProgress[currentWord].lastDate = Date.now();
            }
            localStorage.setItem('gem_pro_v2', JSON.stringify(wordProgress));
            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    currentPool = [...wrongWords]; wrongWords = []; index = 0;
                    alert("å‡†å¤‡å¥½ï¼è¦æŠŠåˆšæ‰è¿˜æ²¡è®°ç‰¢çš„è¯é‡ç»ƒä¸€éå“¦ã€‚");
                } else {
                    alert("ğŸ‰ å¤ªç‰›äº†ï¼ä»Šå¤©çš„ä»»åŠ¡åœ†æ»¡å®Œæˆï¼");
                    location.reload(); return;
                }
            }
            render();
        }

        // --- æ ¸å¿ƒä¿®å¤ï¼šæ›´æ…¢ã€æ›´ç¨³ã€é‡ç½®æ’­æ”¾ ---
        function speak(type) {
            // 1. å½»åº•æ¸…é™¤å½“å‰æ‰€æœ‰å‘éŸ³ä»»åŠ¡ï¼Œé˜²æ­¢å †å äº§ç”Ÿæ‚éŸ³
            window.speechSynthesis.cancel();

            let text = type === 'sentence' ? currentPool[index].sentence : currentPool[index].en;
            let u = new SpeechSynthesisUtterance(text);
            
            // 2. æ ¹æ®ç±»å‹è®¾å®šè¯­é€Ÿï¼šä¾‹å¥ 0.5 (éå¸¸æ…¢)ï¼Œå•è¯ 0.7 (æ¸…æ™°)
            u.rate = type === 'sentence' ? 0.5 : 0.7;
            u.pitch = 1.0; // ç¨³å®šéŸ³é«˜
            
            // 3. è®¾å®šè¯­è¨€
            if(type === 'word-gb') u.lang = 'en-GB';
            else u.lang = 'en-US';

            // 4. å»¶è¿Ÿ 50ms æ’­æ”¾ï¼Œç»™ç³»ç»Ÿé‡Šæ”¾å†…å­˜çš„æ—¶é—´
            setTimeout(() => {
                window.speechSynthesis.speak(u);
            }, 50);
        }

        function render() {
            if (currentPool.length === 0) { document.body.innerHTML = "<h1>å®Œæˆ</h1>"; return; }
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerText = `å‰©ä½™: ${currentPool.length - index} | å¾…é‡ç»ƒ: ${wrongWords.length}`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ipa;
            document.getElementById('sentence-box').innerText = item.sentence;
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            document.getElementById('wordInput').value = "";
            document.getElementById('wordInput').classList.remove('wrong');
            document.getElementById('choice-area').style.display = 'none';
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
        }
        window.onload = render;
    </script>
</body>
</html>






