<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Gemå®¶å±ç‰¹è®­-é«˜æ¸…ç‰ˆ</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --bg: #f4f7f9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 35px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); text-align: center; width: 100%; max-width: 380px; min-height: 560px; display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; }
        .chinese-hint { font-size: 36px; color: #2c3e50; font-weight: bold; margin: 15px 0; }
        .quiz-word { font-size: 34px; letter-spacing: 4px; color: var(--primary); font-weight: bold; min-height: 50px; }
        input { font-size: 26px; padding: 15px; width: 90%; border: 3px solid #eee; border-radius: 18px; text-align: center; outline: none; transition: all 0.2s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(74,144,226,0.2); }
        input.wrong { border-color: var(--error); background: #fff5f5; animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        #choice-area { display: none; margin-top: 15px; background: #fff3e0; padding: 15px; border-radius: 20px; border: 2px dashed #ffb74d; }
        .choice-btn { background: white; border: 2px solid #ffb74d; padding: 12px; margin: 6px; border-radius: 12px; font-size: 18px; width: 85%; cursor: pointer; font-weight: 500; }
        .sentence-container { display: flex; align-items: center; background: #f0f7ff; padding: 15px; border-radius: 18px; margin: 15px 0; text-align: left; border-left: 6px solid var(--primary); }
        .btn-speak { background: var(--primary); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 22px; flex-shrink: 0; box-shadow: 0 4px 12px rgba(74,144,226,0.3); }
        .btn { padding: 18px; border: none; border-radius: 20px; cursor: pointer; font-size: 18px; font-weight: bold; color: white; transition: 0.2s; }
        .btn:active { transform: scale(0.96); }
        .btn-submit { background: #34495e; width: 100%; }
        .btn-next { background: var(--success); width: 100%; display: none; }
        #progress-tag { font-size: 14px; color: #888; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="progress-tag">åŠ è½½ä¸­...</div>

    <div class="card">
        <div id="front-side">
            <div style="font-size:85px; margin-bottom:10px;" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <p style="color:#aaa; font-size:14px;">è§‚å¯Ÿå›¾ç‰‡ï¼Œé™å¿ƒæ€è€ƒ3ç§’</p>
            <button class="btn" style="background:var(--primary); width:100%; margin-top:20px;" id="flip-btn" onclick="showBack()">ğŸ”„ å‡†å¤‡æŒ‘æˆ˜</button>
        </div>

        <div id="back-side" style="display:none">
            <div id="ipa-display" style="color:#95a5a6; font-size:20px; margin-bottom:8px;"></div>
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¯·è¾“å…¥å•è¯" autocomplete="off">
            
            <div id="choice-area">
                <p style="margin:0 0 10px 0; color:#e67e22; font-weight:bold;">ğŸ” å¯»å®æç¤ºï¼šä»ä¸‹é¢è®¤å‡ºå®ƒ</p>
                <div id="choices-list"></div>
            </div>

            <div class="sentence-container">
                <div id="sentence-box" style="flex:1; font-size:16px; color:#34495e; padding-right:10px; line-height:1.4;"></div>
                <button class="btn-speak" onclick="safeSpeak('sentence')">ğŸ”Š</button>
            </div>

            <div style="display:flex; gap:12px; margin-bottom:10px;">
                <button class="btn" style="background:#9b59b6; flex:1;" onclick="safeSpeak('word-gb')">ğŸ‡¬ğŸ‡§ è‹±éŸ³</button>
                <button class="btn" style="background:#9b59b6; flex:1;" onclick="safeSpeak('word-us')">ğŸ‡ºğŸ‡¸ ç¾éŸ³</button>
            </div>
            <button id="submit-btn" class="btn btn-submit" onclick="submitAnswer()">ç¡®è®¤æäº¤</button>
        </div>
        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ å¤ªæ£’äº†ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // ==========================================
        // 1. ã€ä¹¦æ¶åŒº / æ•°æ®åŒºã€‘
        // ä»¥åä½ åªéœ€è¦ä¿®æ”¹æˆ–å¢åŠ ä¸‹é¢çš„å†…å®¹
        // ==========================================
        const wordList = [
    // --- ç¬¬ä¸€ç»„ï¼šåŠ¨ä½œä¸èº«ä½“ ---
    { word: "Wash", meaning: "æ´—", type: "åŠ¨è¯", phonetic: "/wÉ’Êƒ/", example: "Wash your hands." },
    { word: "Hand", meaning: "æ‰‹", type: "åè¯", phonetic: "/hÃ¦nd/", example: "I have two hands." },
    { word: "Clean", meaning: "å¹²å‡€çš„", type: "å½¢å®¹è¯", phonetic: "/kliËn/", example: "The floor is clean." },
    { word: "Shake", meaning: "æ‘‡/æ¡", type: "åŠ¨è¯", phonetic: "/ÊƒeÉªk/", example: "Shake hands with your friend." },
    { word: "Friend", meaning: "æœ‹å‹", type: "åè¯", phonetic: "/frend/", example: "She is my best friend." },
    { word: "Nice", meaning: "å‹å¥½çš„", type: "å½¢å®¹è¯", phonetic: "/naÉªs/", example: "It's nice to meet you." },

    // --- ç¬¬äºŒç»„ï¼šæ„ŸçŸ¥ä¸äº¤æµ ---
    { word: "Listen", meaning: "å¬", type: "åŠ¨è¯", phonetic: "/ËˆlÉªsn/", example: "Listen to the music." },
    { word: "Ear", meaning: "è€³æœµ", type: "åè¯", phonetic: "/ÉªÉ™r/", example: "We hear with our ears." },
    { word: "Good", meaning: "å¥½çš„", type: "å½¢å®¹è¯", phonetic: "/É¡ÊŠd/", example: "That's a good idea." },
    { word: "Talk", meaning: "è°ˆè¯", type: "åŠ¨è¯", phonetic: "/tÉ”Ëk/", example: "Talk to your teacher." },
    { word: "Mouth", meaning: "å˜´", type: "åè¯", phonetic: "/maÊŠÎ¸/", example: "Open your mouth." },
    { word: "Small", meaning: "å°çš„", type: "å½¢å®¹è¯", phonetic: "/smÉ”Ël/", example: "The cat is very small." },

    // --- ç¬¬ä¸‰ç»„ï¼šå­¦ä¹ ä¸ä¹¦å†™ ---
    { word: "Write", meaning: "å†™", type: "åŠ¨è¯", phonetic: "/raÉªt/", example: "Write your name here." },
    { word: "Letter", meaning: "ä¿¡/å­—æ¯", type: "åè¯", phonetic: "/ËˆletÉ™/", example: "A is the first letter." },
    { word: "Different", meaning: "ä¸åŒçš„", type: "å½¢å®¹è¯", phonetic: "/ËˆdÉªfrÉ™nt/", example: "They look different." },
    { word: "Read", meaning: "è¯»", type: "åŠ¨è¯", phonetic: "/riËd/", example: "Read the book aloud." },
    { word: "Word", meaning: "å•è¯", type: "åè¯", phonetic: "/wÉœËd/", example: "What does this word mean?" },
    { word: "Same", meaning: "ç›¸åŒçš„", type: "å½¢å®¹è¯", phonetic: "/seÉªm/", example: "We have the same toy." },

    // --- ç¬¬å››ç»„ï¼šè‡ªç„¶ä¸å¤©æ°” ---
    { word: "See", meaning: "çœ‹è§", type: "åŠ¨è¯", phonetic: "/siË/", example: "I can see a bird." },
    { word: "Sea", meaning: "å¤§æµ·", type: "åè¯", phonetic: "/siË/", example: "The sea is blue." },
    { word: "Sunny", meaning: "æ™´æœ—çš„", type: "å½¢å®¹è¯", phonetic: "/ËˆsÊŒni/", example: "It's a sunny day." },
    { word: "Rainy", meaning: "ä¸‹é›¨çš„", type: "å½¢å®¹è¯", phonetic: "/ËˆreÉªni/", example: "I don't like rainy days." },
    { word: "Warm", meaning: "æ¸©æš–çš„", type: "å½¢å®¹è¯", phonetic: "/wÉ”Ëm/", example: "The weather is warm." },
    { word: "Cold", meaning: "å¯’å†·çš„", type: "å½¢å®¹è¯", phonetic: "/kÉ™ÊŠld/", example: "It's very cold today." },

    // --- ç¬¬äº”ç»„ï¼šç”Ÿæ´»ä¸åŠ¨ä½œ ---
    { word: "Sit", meaning: "å", type: "åŠ¨è¯", phonetic: "/sÉªt/", example: "Sit down, please." },
    { word: "Shop", meaning: "å•†åº—/è´­ç‰©", type: "åè¯/åŠ¨è¯", phonetic: "/ÊƒÉ’p/", example: "Let's go to the shop." },
    { word: "New", meaning: "æ–°çš„", type: "å½¢å®¹è¯", phonetic: "/njuË/", example: "I have a new bag." },
    { word: "Love", meaning: "çˆ±", type: "åŠ¨è¯", phonetic: "/lÊŒv/", example: "I love my family." },
    { word: "Food", meaning: "é£Ÿç‰©", type: "åè¯", phonetic: "/fuËd/", example: "Healthy food is good." },
    { word: "Amazing", meaning: "ç¥å¥‡çš„", type: "å½¢å®¹è¯", phonetic: "/É™ËˆmeÉªzÉªÅ‹/", example: "The castle is amazing!" },

    // --- å…¶ä½™æ ¸å¿ƒè¯æ±‡ (å·²å…¨éƒ¨è½¬æ¢æ ¼å¼) ---
    { word: "Sing", meaning: "å”±æ­Œ", type: "åŠ¨è¯", phonetic: "/sÉªÅ‹/", example: "Sing a song." },
    { word: "Wave", meaning: "æŒ¥æ‰‹", type: "åŠ¨è¯", phonetic: "/weÉªv/", example: "Wave goodbye." },
    { word: "Point", meaning: "æŒ‡", type: "åŠ¨è¯", phonetic: "/pÉ”Éªnt/", example: "Point to the window." },
    { word: "Look", meaning: "çœ‹", type: "åŠ¨è¯", phonetic: "/lÊŠk/", example: "Look at the map." },
    { word: "Do", meaning: "åš", type: "åŠ¨è¯", phonetic: "/duË/", example: "Do your homework." },
    { word: "Name", meaning: "åå­—", type: "åè¯", phonetic: "/neÉªm/", example: "What's your name?" },
    { word: "Eye", meaning: "çœ¼ç›", type: "åè¯", phonetic: "/aÉª/", example: "Close your eyes." },
    { word: "Month", meaning: "æœˆä»½", type: "åè¯", phonetic: "/mÊŒnÎ¸/", example: "Which month is it?" },
    { word: "Foot", phonetic: "/fÊŠt/", type: "åè¯", meaning: "è„š", example: "Wash your feet." },
    { word: "Arm", phonetic: "/É‘Ëm/", type: "åè¯", meaning: "èƒ³è†Š", example: "My arms are long." },
    { word: "Sound", phonetic: "/saÊŠnd/", type: "åè¯", meaning: "å£°éŸ³", example: "Listen to the sound." },
    { word: "First", phonetic: "/fÉœËst/", type: "å½¢å®¹è¯", meaning: "ç¬¬ä¸€çš„", example: "The first day of school." },
    { word: "Smell", phonetic: "/smel/", type: "åŠ¨è¯/åè¯", meaning: "é—»", example: "The flowers smell nice." },
    { word: "Can", phonetic: "/kÃ¦n/", type: "åŠ©åŠ¨è¯", meaning: "èƒ½", example: "I can swim." },
    { word: "Too", phonetic: "/tuË/", type: "å‰¯è¯", meaning: "ä¹Ÿ/å¤ª", example: "Me too." },
    { word: "Two", phonetic: "/tuË/", type: "æ•°è¯", meaning: "äºŒ", example: "I have two pencils." },
    { word: "Air", phonetic: "/eÉ™/", type: "åè¯", meaning: "ç©ºæ°”", example: "The air is fresh." },
    { word: "Here", phonetic: "/hÉªÉ™/", type: "å‰¯è¯", meaning: "è¿™é‡Œ", example: "Come here." },
    { word: "There", phonetic: "/Ã°eÉ™/", type: "å‰¯è¯", meaning: "é‚£é‡Œ", example: "Look over there." },
    { word: "Have", phonetic: "/hÃ¦v/", type: "åŠ¨è¯", phonetic: "/hÃ¦v/", meaning: "æœ‰", example: "I have a sister." },
    { word: "Their", phonetic: "/Ã°eÉ™/", type: "ä»£è¯", meaning: "ä»–ä»¬çš„", example: "It is their house." },
    { word: "They", phonetic: "/Ã°eÉª/", type: "ä»£è¯", meaning: "ä»–ä»¬", example: "They are happy." },
    { word: "Them", phonetic: "/Ã°em/", type: "ä»£è¯", meaning: "ä»–ä»¬(å®¾æ ¼)", example: "I like them." },
    { word: "She", phonetic: "/ÊƒiË/", type: "ä»£è¯", meaning: "å¥¹", example: "She is a doctor." },
    { word: "Her", phonetic: "/hÉœË/", type: "ä»£è¯", meaning: "å¥¹/å¥¹çš„", example: "That is her car." },
    { word: "Ask", phonetic: "/É‘Ësk/", type: "åŠ¨è¯", meaning: "é—®", example: "Ask a question." },
    { word: "Some", phonetic: "/sÊŒm/", type: "å½¢å®¹è¯", meaning: "ä¸€äº›", example: "I want some water." },
    { word: "Answer", phonetic: "/ËˆÉ‘ËnsÉ™/", type: "åŠ¨è¯/åè¯", meaning: "å›ç­”", example: "Answer the phone." },
    { word: "Each", phonetic: "/iËtÊƒ/", type: "å½¢å®¹è¯", meaning: "æ¯ä¸ª", example: "Each child gets a toy." },
    { word: "Together", phonetic: "/tÉ™ËˆÉ¡eÃ°É™/", type: "å‰¯è¯", meaning: "ä¸€èµ·", example: "Let's play together." },
    { word: "Hold", phonetic: "/hÉ™ÊŠld/", type: "åŠ¨è¯", meaning: "æ‹¿/æŠ±", example: "Hold my hand." },
    { word: "Now", phonetic: "/naÊŠ/", type: "å‰¯è¯", meaning: "ç°åœ¨", example: "Do it now." },
    { word: "Start", phonetic: "/stÉ‘Ët/", type: "åŠ¨è¯", meaning: "å¼€å§‹", example: "Start the game." },
    { word: "Toy", phonetic: "/tÉ”Éª/", type: "åè¯", meaning: "ç©å…·", example: "Where is my toy?" },
    { word: "Stop", phonetic: "/stÉ’p/", type: "åŠ¨è¯", meaning: "åœæ­¢", example: "Stop the car." },
    { word: "Fruit", phonetic: "/fruËt/", type: "åè¯", meaning: "æ°´æœ", example: "Eat some fruit." },
    { word: "Live", phonetic: "/lÉªv/", type: "åŠ¨è¯", meaning: "å±…ä½/ç”Ÿæ´»", example: "Where do you live?" },
    { word: "Feel", phonetic: "/fiËl/", type: "åŠ¨è¯", meaning: "æ„Ÿè§‰", example: "I feel happy." },
    { word: "Like", phonetic: "/laÉªk/", type: "åŠ¨è¯", meaning: "å–œæ¬¢", example: "I like apples." },
    { word: "Fast", phonetic: "/fÉ‘Ëst/", type: "å½¢å®¹è¯", meaning: "å¿«çš„", example: "The car is fast." },
    { word: "Slow", phonetic: "/slÉ™ÊŠ/", type: "å½¢å®¹è¯", meaning: "æ…¢çš„", example: "The turtle is slow." },
    { word: "Know", phonetic: "/nÉ™ÊŠ/", type: "åŠ¨è¯", meaning: "çŸ¥é“", example: "I know the answer." },
    { word: "Animal", phonetic: "/ËˆÃ¦nÉªml/", type: "åè¯", meaning: "åŠ¨ç‰©", example: "What's your favorite animal?" },
    { word: "Sea", phonetic: "/siË/", type: "åè¯", meaning: "å¤§æµ·", example: "Look at the sea." },
    { word: "Bee", phonetic: "/biË/", type: "åè¯", meaning: "èœœèœ‚", example: "A bee is on the flower." },
    { word: "Make", phonetic: "/meÉªk/", type: "åŠ¨è¯", meaning: "åˆ¶ä½œ", example: "Make a card." },
    { word: "Touch", phonetic: "/tÊŒtÊƒ/", type: "åŠ¨è¯", meaning: "è§¦æ‘¸", example: "Don't touch that." },
    { word: "Around", phonetic: "/É™ËˆraÊŠnd/", type: "å‰¯è¯", meaning: "åœ¨...å‘¨å›´", example: "Run around the park." },
    { word: "Again", phonetic: "/É™ËˆÉ¡en/", type: "å‰¯è¯", meaning: "å†æ¬¡", example: "Try again." },
    { word: "Many", phonetic: "/Ëˆmeni/", type: "å½¢å®¹è¯", meaning: "è®¸å¤š", example: "Many children like it." },
    { word: "Card", phonetic: "/kÉ‘Ëd/", type: "åè¯", meaning: "å¡ç‰‡", example: "Send a card." },
    { word: "Number", phonetic: "/ËˆnÊŒmbÉ™/", type: "åè¯", meaning: "æ•°å­—", example: "What's your number?" },
    { word: "Spider", phonetic: "/ËˆspaÉªdÉ™/", type: "åè¯", meaning: "èœ˜è››", example: "A spider is on the wall." },
    { word: "Over", phonetic: "/ËˆÉ™ÊŠvÉ™/", type: "ä»‹è¯", meaning: "åœ¨...ä¸Šæ–¹", example: "Jump over the box." },
    { word: "Right", phonetic: "/raÉªt/", type: "å½¢å®¹è¯", meaning: "æ­£ç¡®çš„", example: "That's right." },
    { word: "Wrong", phonetic: "/rÉ’Å‹/", type: "å½¢å®¹è¯", meaning: "é”™è¯¯çš„", example: "It's wrong." }
];

        // ==========================================
        // 2. ã€ä¸»ç¨‹åº / é€»è¾‘åŒºã€‘
        // è¿™é‡Œçš„ä»£ç å¤„ç†å‘éŸ³ã€æ£€æµ‹ã€å¯»å®é€»è¾‘ï¼Œè½»æ˜“ä¸è¦åŠ¨
        // ==========================================
        let wordProgress = JSON.parse(localStorage.getItem('gem_final_pro_v3')) || {};
        wordLibrary.forEach(w => { if(!wordProgress[w.en]) wordProgress[w.en] = { level: 0 }; });

        let currentPool = [...wordLibrary], wrongWords = [], index = 0, hasLooked = false;

        function safeSpeak(type) {
            window.speechSynthesis.cancel(); 
            setTimeout(() => {
                const item = currentPool[index];
                const text = type === 'sentence' ? item.sentence : item.en;
                const msg = new SpeechSynthesisUtterance(text);
                msg.rate = type === 'sentence' ? 0.45 : 0.7; // æ…¢é€Ÿé«˜æ¸…
                msg.pitch = 1.0;
                msg.volume = 1.0;
                if(type === 'word-gb') msg.lang = 'en-GB';
                else msg.lang = 'en-US';
                window.speechSynthesis.speak(msg);
            }, 50);
        }

        function showBack() {
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function submitAnswer() {
            const input = document.getElementById('wordInput');
            const userVal = input.value.toLowerCase().trim();
            const correctVal = currentPool[index].en.toLowerCase();
            if (userVal === correctVal) {
                input.classList.remove('wrong');
                document.getElementById('submit-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('choice-area').style.display = 'none';
                safeSpeak('word-gb');
            } else {
                input.classList.add('wrong');
                showChoices();
                hasLooked = true;
            }
        }

        function showChoices() {
            const area = document.getElementById('choice-area');
            const list = document.getElementById('choices-list');
            area.style.display = 'block';
            list.innerHTML = "";
            let choices = [currentPool[index].en];
            while(choices.length < 3) {
                let r = wordLibrary[Math.floor(Math.random()*wordLibrary.length)].en;
                if(!choices.includes(r)) choices.push(r);
            }
            choices.sort(() => Math.random() - 0.5);
            choices.forEach(c => {
                let btn = document.createElement('button');
                btn.className = "choice-btn";
                btn.innerText = c;
                btn.onclick = () => {
                    document.getElementById('wordInput').value = "";
                    document.getElementById('wordInput').focus();
                };
                list.appendChild(btn);
            });
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
            }
            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    currentPool = [...wrongWords]; wrongWords = []; index = 0;
                    alert("è¿›å…¥å¼ºåŒ–å¤ä¹ æ¨¡å¼ï¼");
                } else {
                    alert("ğŸ‰ å¤ªæ£’äº†ï¼ä»»åŠ¡å®Œæˆï¼");
                    location.reload(); return;
                }
            }
            render();
        }

        function render() {
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerText = `ç¬¬ ${index + 1} ä¸ªï¼Œå…± ${currentPool.length} ä¸ª`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ip || "";
            document.getElementById('sentence-box').innerText = item.sentence;
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            document.getElementById('wordInput').value = "";
            document.getElementById('wordInput').classList.remove('wrong');
            document.getElementById('choice-area').style.display = 'none';
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
            
            const flipBtn = document.getElementById('flip-btn');
            flipBtn.disabled = true;
            let sec = 3;
            const timer = setInterval(() => {
                sec--;
                if(sec <= 0) {
                    flipBtn.innerText = "ğŸ”„ å‡†å¤‡æŒ‘æˆ˜";
                    flipBtn.disabled = false;
                    clearInterval(timer);
                } else {
                    flipBtn.innerText = `æ€è€ƒä¸­ (${sec}s)`;
                }
            }, 1000);
        }

        window.onload = render;
    </script>
</body>
</html>
