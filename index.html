<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Gemå®¶å±ç‰¹è®­-é«˜æ¸…ç‰ˆ</title>
    <link rel="manifest" href="manifest.json?v=2">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2911/2911000.png">
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --error: #e74c3c; --bg: #f4f7f9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 35px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); text-align: center; width: 100%; max-width: 380px; min-height: 560px; display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; }
        .chinese-hint { font-size: 36px; color: #2c3e50; font-weight: bold; margin: 15px 0; }
        .quiz-word { font-size: 34px; letter-spacing: 4px; color: var(--primary); font-weight: bold; min-height: 50px; }
        input { font-size: 26px; padding: 15px; width: 90%; border: 3px solid #eee; border-radius: 18px; text-align: center; outline: none; transition: all 0.2s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(74,144,226,0.2); }
        input.wrong { border-color: var(--error); background: #fff5f5; animation: shake 0.4s; }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-8px)} 75%{transform:translateX(8px)} }
        #choice-area { display: none; margin-top: 15px; background: #fff3e0; padding: 15px; border-radius: 20px; border: 2px dashed #ffb74d; }
        .choice-btn { background: white; border: 2px solid #ffb74d; padding: 12px; margin: 6px; border-radius: 12px; font-size: 18px; width: 85%; cursor: pointer; font-weight: 500; }
        .sentence-container { display: flex; align-items: center; background: #f0f7ff; padding: 15px; border-radius: 18px; margin: 15px 0; text-align: left; border-left: 6px solid var(--primary); }
        .btn-speak { background: var(--primary); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 22px; flex-shrink: 0; box-shadow: 0 4px 12px rgba(74,144,226,0.3); }
        .btn { padding: 18px; border: none; border-radius: 20px; cursor: pointer; font-size: 18px; font-weight: bold; color: white; transition: 0.2s; }
        .btn:active { transform: scale(0.96); }
        .btn-submit { background: #34495e; width: 100%; }
        .btn-next { background: var(--success); width: 100%; display: none; }
        #progress-tag { font-size: 14px; color: #888; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="progress-tag">åŠ è½½ä¸­...</div>

    <div class="card">
        <div id="front-side">
            <div style="font-size:85px; margin-bottom:10px;" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <p style="color:#aaa; font-size:14px;">è§‚å¯Ÿå›¾ç‰‡ï¼Œé™å¿ƒæ€è€ƒ3ç§’</p>
            <button class="btn" style="background:var(--primary); width:100%; margin-top:20px;" id="flip-btn" onclick="showBack()">ğŸ”„ å‡†å¤‡æŒ‘æˆ˜</button>
        </div>

        <div id="back-side" style="display:none">
            <div id="ipa-display" style="color:#95a5a6; font-size:20px; margin-bottom:8px;"></div>
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¯·è¾“å…¥å•è¯" autocomplete="off">
            
            <div id="choice-area">
                <p style="margin:0 0 10px 0; color:#e67e22; font-weight:bold;">ğŸ” å¯»å®æç¤ºï¼šä»ä¸‹é¢è®¤å‡ºå®ƒ</p>
                <div id="choices-list"></div>
            </div>

            <div class="sentence-container">
                <div id="sentence-box" style="flex:1; font-size:16px; color:#34495e; padding-right:10px; line-height:1.4;"></div>
                <button class="btn-speak" onclick="safeSpeak('sentence')">ğŸ”Š</button>
            </div>

            <div style="display:flex; gap:12px; margin-bottom:10px;">
                <button class="btn" style="background:#9b59b6; flex:1;" onclick="safeSpeak('word-gb')">ğŸ‡¬ğŸ‡§ è‹±éŸ³</button>
                <button class="btn" style="background:#9b59b6; flex:1;" onclick="safeSpeak('word-us')">ğŸ‡ºğŸ‡¸ ç¾éŸ³</button>
            </div>
            <button id="submit-btn" class="btn btn-submit" onclick="submitAnswer()">ç¡®è®¤æäº¤</button>
        </div>
        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ å¤ªæ£’äº†ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // ==========================================
        // 1. ã€ä¹¦æ¶åŒº / æ•°æ®åŒºã€‘
        // ä»¥åä½ åªéœ€è¦ä¿®æ”¹æˆ–å¢åŠ ä¸‹é¢çš„å†…å®¹
        // ==========================================
                const wordLibrary = [
            // --- ç¬¬ä¸€æ‰¹ï¼šåŸºç¡€ç–‘é—®è¯ä¸åŠ¨ä½œ (ä¹‹å‰çš„) ---
            { en: "What", ip: "/wÉ’t/", cn: "ä»€ä¹ˆ", icon: "â“", sentence: "What is your name?" },
            { en: "How", ip: "/haÊŠ/", cn: "æ€æ ·", icon: "ğŸ› ï¸", sentence: "How are you today?" },
            { en: "Where", ip: "/weÉ™/", cn: "å“ªé‡Œ", icon: "ğŸ“", sentence: "Where is my book?" },
            { en: "Who", ip: "/huË/", cn: "è°", icon: "ğŸ‘¤", sentence: "Who is that girl?" },
            { en: "Run", ip: "/rÊŒn/", cn: "è·‘", icon: "ğŸƒ", sentence: "Do not run in the hall." },
            { en: "Swim", ip: "/swÉªm/", cn: "æ¸¸æ³³", icon: "ğŸŠ", sentence: "Fish swim in the water." },
            { en: "Fly", ip: "/flaÉª/", cn: "é£", icon: "âœˆï¸", sentence: "I can fly a kite." },
            { en: "Jump", ip: "/dÊ’ÊŒmp/", cn: "è·³", icon: "ğŸ¦˜", sentence: "Jump up high!" },
            
            // --- ç¬¬äºŒæ‰¹ï¼šç¬”è®°é‡Œçš„æ–°è¯ (ç¤¾äº¤ä¸æŒ‡ä»¤) ---
            { en: "Share", ip: "/ÊƒeÉ™/", cn: "åˆ†äº«", icon: "ğŸ°", sentence: "Please share your toys." },
            { en: "Thank", ip: "/Î¸Ã¦Å‹k/", cn: "è°¢è°¢", icon: "ğŸ™", sentence: "Thank you for your help." },
            { en: "Help", ip: "/help/", cn: "å¸®åŠ©", icon: "ğŸ¤", sentence: "Can you help me?" },
            { en: "Play", ip: "/pleÉª/", cn: "ç©", icon: "ğŸ®", sentence: "Let's play together." },
            { en: "Question", ip: "/'kwestÊƒÉ™n/", cn: "é—®é¢˜", icon: "â”", sentence: "I have a question." },
            { en: "Repeat", ip: "/rÉª'piËt/", cn: "é‡å¤", icon: "ğŸ”", sentence: "Repeat after me." },
            { en: "Circle", ip: "/'sÉœËkl/", cn: "åœˆå‡º", icon: "â­•", sentence: "Circle the red apple." },
            { en: "Chant", ip: "/tÊƒÉ‘Ënt/", cn: "æ­Œè°£", icon: "ğŸµ", sentence: "Let's say the chant." },
            { en: "Draw", ip: "/drÉ”Ë/", cn: "ç”»", icon: "ğŸ¨", sentence: "Can you draw a cat?" },

            // --- ç¬¬ä¸‰æ‰¹ï¼šç¬”è®°é‡Œçš„æ–¹ä½ä»‹è¯ (ç‰¹è®­éš¾ç‚¹) ---
            { en: "In", ip: "/Éªn/", cn: "åœ¨...é‡Œ", icon: "ğŸ“¥", sentence: "It is in the box." },
            { en: "On", ip: "/É’n/", cn: "åœ¨...ä¸Š", icon: "ğŸ”", sentence: "The cat is on the mat." },
            { en: "At", ip: "/Ã¦t/", cn: "åœ¨æŸå¤„", icon: "ğŸ“", sentence: "I am at school." },
            { en: "Into", ip: "/'Éªntu/", cn: "åˆ°...é‡Œ", icon: "ğŸ“©", sentence: "Jump into the water." },
            { en: "Under", ip: "/'ÊŒndÉ™/", cn: "åœ¨...ä¸‹", icon: "ğŸ‘‡", sentence: "It is under your chair." },
            { en: "Behind", ip: "/bÉªËˆhaÉªnd/", cn: "åœ¨...å", icon: "ğŸ”™", sentence: "The cat is behind the box." },
            { en: "Beside", ip: "/bÉªËˆsaÉªd/", cn: "åœ¨...æ—", icon: "ğŸ”œ", sentence: "Stand beside me." },
            { en: "Between", ip: "/bÉªËˆtwiËn/", cn: "åœ¨...é—´", icon: "â†”ï¸", sentence: "It is between the trees." },

            // --- ç¬¬å››æ‰¹ï¼šå…¶ä»–ç¬”è®°è¯æ±‡ ---
            { en: "Sun", ip: "/sÊŒn/", cn: "å¤ªé˜³", icon: "â˜€ï¸", sentence: "The sun is hot." },
            { en: "Duck", ip: "/dÊŒk/", cn: "é¸­å­", icon: "ğŸ¦†", sentence: "Look at the duck." },
            { en: "Careful", ip: "/'keÉ™fl/", cn: "å°å¿ƒçš„", icon: "âš ï¸", sentence: "Be careful!" },
            { en: "Head", ip: "/hed/", cn: "å¤´", icon: "ğŸ‘¤", sentence: "Touch your head." },
            { en: "Toe", ip: "/tÉ™ÊŠ/", cn: "è„šè¶¾", icon: "ğŸ¦¶", sentence: "Touch your toes." },
            { en: "Wing", ip: "/wÉªÅ‹/", cn: "ç¿…è†€", icon: "ğŸ¦‹", sentence: "The bird has wings." },
            { en: "Hurry", ip: "/'hÊŒri/", cn: "èµ¶å¿«", icon: "ğŸƒ", sentence: "Hurry up, let's go!" },
            { en: "This", ip: "/Ã°Éªs/", cn: "è¿™", icon: "ğŸ“", sentence: "This is my pencil." },
            { en: "That", ip: "/Ã°Ã¦t/", cn: "é‚£", icon: "ğŸ”­", sentence: "That is a big bird." }
        ];


        // ==========================================
        // 2. ã€ä¸»ç¨‹åº / é€»è¾‘åŒºã€‘
        // è¿™é‡Œçš„ä»£ç å¤„ç†å‘éŸ³ã€æ£€æµ‹ã€å¯»å®é€»è¾‘ï¼Œè½»æ˜“ä¸è¦åŠ¨
        // ==========================================
        let wordProgress = JSON.parse(localStorage.getItem('gem_final_pro_v3')) || {};
        wordLibrary.forEach(w => { if(!wordProgress[w.en]) wordProgress[w.en] = { level: 0 }; });

        let currentPool = [...wordLibrary], wrongWords = [], index = 0, hasLooked = false;

        function safeSpeak(type) {
            window.speechSynthesis.cancel(); 
            setTimeout(() => {
                const item = currentPool[index];
                const text = type === 'sentence' ? item.sentence : item.en;
                const msg = new SpeechSynthesisUtterance(text);
                msg.rate = type === 'sentence' ? 0.45 : 0.7; // æ…¢é€Ÿé«˜æ¸…
                msg.pitch = 1.0;
                msg.volume = 1.0;
                if(type === 'word-gb') msg.lang = 'en-GB';
                else msg.lang = 'en-US';
                window.speechSynthesis.speak(msg);
            }, 50);
        }

        function showBack() {
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function submitAnswer() {
            const input = document.getElementById('wordInput');
            const userVal = input.value.toLowerCase().trim();
            const correctVal = currentPool[index].en.toLowerCase();
            if (userVal === correctVal) {
                input.classList.remove('wrong');
                document.getElementById('submit-btn').style.display = 'none';
                document.getElementById('next-btn').style.display = 'block';
                document.getElementById('choice-area').style.display = 'none';
                safeSpeak('word-gb');
            } else {
                input.classList.add('wrong');
                showChoices();
                hasLooked = true;
            }
        }

        function showChoices() {
            const area = document.getElementById('choice-area');
            const list = document.getElementById('choices-list');
            area.style.display = 'block';
            list.innerHTML = "";
            let choices = [currentPool[index].en];
            while(choices.length < 3) {
                let r = wordLibrary[Math.floor(Math.random()*wordLibrary.length)].en;
                if(!choices.includes(r)) choices.push(r);
            }
            choices.sort(() => Math.random() - 0.5);
            choices.forEach(c => {
                let btn = document.createElement('button');
                btn.className = "choice-btn";
                btn.innerText = c;
                btn.onclick = () => {
                    document.getElementById('wordInput').value = "";
                    document.getElementById('wordInput').focus();
                };
                list.appendChild(btn);
            });
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            if (hasLooked) {
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
            }
            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    currentPool = [...wrongWords]; wrongWords = []; index = 0;
                    alert("è¿›å…¥å¼ºåŒ–å¤ä¹ æ¨¡å¼ï¼");
                } else {
                    alert("ğŸ‰ å¤ªæ£’äº†ï¼ä»»åŠ¡å®Œæˆï¼");
                    location.reload(); return;
                }
            }
            render();
        }

        function render() {
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerText = `ç¬¬ ${index + 1} ä¸ªï¼Œå…± ${currentPool.length} ä¸ª`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('ipa-display').innerText = item.ip || "";
            document.getElementById('sentence-box').innerText = item.sentence;
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            document.getElementById('wordInput').value = "";
            document.getElementById('wordInput').classList.remove('wrong');
            document.getElementById('choice-area').style.display = 'none';
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
            
            const flipBtn = document.getElementById('flip-btn');
            flipBtn.disabled = true;
            let sec = 3;
            const timer = setInterval(() => {
                sec--;
                if(sec <= 0) {
                    flipBtn.innerText = "ğŸ”„ å‡†å¤‡æŒ‘æˆ˜";
                    flipBtn.disabled = false;
                    clearInterval(timer);
                } else {
                    flipBtn.innerText = `æ€è€ƒä¸­ (${sec}s)`;
                }
            }, 1000);
        }

        window.onload = render;
    </script>
</body>
</html>







