<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemå®¶å±ä¸“å±-æ™ºèƒ½è®°å¿†App</title>
    <style>
        :root { --primary: #4a90e2; --success: #2ecc71; --warning: #f1c40f; --bg: #f0f2f5; }
        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 15px; }
        .card { background: white; border-radius: 25px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; min-height: 400px; display: flex; flex-direction: column; justify-content: space-between; }
        .hint-area { font-size: 80px; margin-bottom: 5px; }
        .chinese-hint { font-size: 28px; color: #333; font-weight: bold; margin: 10px 0; }
        .quiz-word { font-size: 32px; letter-spacing: 4px; color: var(--primary); font-weight: bold; min-height: 40px; }
        input { font-size: 24px; padding: 12px; width: 85%; border: 3px solid #ddd; border-radius: 12px; text-align: center; outline: none; }
        input.correct { border-color: var(--success); background-color: #f0fff4; }
        .btn { padding: 15px; border: none; border-radius: 12px; cursor: pointer; font-size: 18px; font-weight: bold; margin: 5px; color: white; }
        .btn-audio { background: #9b59b6; width: 45%; }
        .btn-flip { background: var(--primary); width: 100%; margin-top: 10px; }
        .btn-next { background: var(--success); width: 100%; margin-top: 10px; display: none; }
        #timer-msg { color: #e67e22; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        #progress-tag { background: #eee; padding: 6px 12px; border-radius: 20px; font-size: 12px; margin-bottom: 10px; line-height: 1.5; }
    </style>
</head>
<body>

    <div id="progress-tag">åŠ è½½ä¸­...</div>
    <div id="timer-msg">å‡†å¤‡å¥½æŒ‘æˆ˜äº†å—ï¼Ÿ</div>

    <div class="card">
        <div id="front-side">
            <div class="hint-area" id="icon-display"></div>
            <div class="chinese-hint" id="cn-display"></div>
            <button class="btn btn-flip" id="flip-btn" onclick="showBack()">ğŸ”„ æŒ‘æˆ˜æ‹¼å†™</button>
        </div>

        <div id="back-side" style="display:none">
            <div class="quiz-word" id="word-hint"></div>
            <input type="text" id="wordInput" placeholder="è¾“å…¥å•è¯..." oninput="checkInput(event)">
            <div style="margin-top:15px; display:flex; justify-content: center;">
                <button class="btn btn-audio" onclick="speak('en-GB')">è‹±éŸ³ ğŸ‡¬ğŸ‡§</button>
                <button class="btn btn-audio" onclick="speak('en-US')">ç¾éŸ³ ğŸ‡ºğŸ‡¸</button>
            </div>
        </div>

        <button id="next-btn" class="btn btn-next" onclick="handleNext()">ğŸŒŸ æ‹¼å¯¹äº†ï¼ä¸‹ä¸€ä¸ª</button>
    </div>

    <script>
        // 1. åŸºç¡€è¯åº“ (Gemå¯ä»¥ç»§ç»­åœ¨è¿™é‡Œå¢åŠ )
        const originalLib = [
            { en: "Red", cn: "çº¢è‰²", icon: "â¤ï¸" }, { en: "Blue", cn: "è“è‰²", icon: "ğŸ’™" },
            { en: "Cat", cn: "çŒ«", icon: "ğŸ±" }, { en: "Dog", cn: "ç‹—", icon: "ğŸ¶" },
            { en: "Apple", cn: "è‹¹æœ", icon: "ğŸ" }, { en: "One", cn: "1", icon: "1ï¸âƒ£" },
            { en: "Father", cn: "çˆ¸çˆ¸", icon: "ğŸ‘¨" }, { en: "Mother", cn: "å¦ˆå¦ˆ", icon: "ğŸ‘©" }
        ];

        // 2. åˆå§‹åŒ–æœ¬åœ°è®°å¿†è¿›åº¦
        let wordProgress = JSON.parse(localStorage.getItem('gem_word_v1')) || {};
        originalLib.forEach(w => {
            if (!wordProgress[w.en]) wordProgress[w.en] = { level: 0, lastDate: 0 };
        });

        // 3. ç­›é€‰ä»Šæ—¥ä»»åŠ¡ (æ–°è¯ + åˆ°æœŸçš„æ—§è¯)
        const oneDay = 24 * 60 * 60 * 1000;
        let todayLib = originalLib.filter(w => {
            let p = wordProgress[w.en];
            const now = Date.now();
            if (p.level === 0) return true; 
            if (p.level === 1 && now - p.lastDate > oneDay) return true;
            if (p.level === 2 && now - p.lastDate > 6 * oneDay) return true;
            return false;
        });

        // 4. è¿è¡Œå˜é‡
        let currentPool = todayLib.length > 0 ? [...todayLib] : []; 
        let wrongWords = []; 
        let index = 0;
        let hasLooked = false;

        function lock() {
            const fb = document.getElementById('flip-btn');
            fb.disabled = true;
            let c = 3;
            const tm = document.getElementById('timer-msg');
            const t = setInterval(() => {
                c--;
                if(c>0) tm.innerText = `â³ è§‚å¯Ÿæ€è€ƒ (${c}s)`;
                else { tm.innerText = "âœ… å¯ä»¥ç¿»é¢æŒ‘æˆ˜äº†"; fb.disabled = false; clearInterval(t); }
            }, 1000);
        }

        function showBack() {
            hasLooked = true; // åªè¦çœ‹ç­”æ¡ˆï¼Œå°±ç®—æ²¡æŒæ¡ï¼Œéœ€è¦é‡ç»ƒ
            document.getElementById('front-side').style.display = 'none';
            document.getElementById('back-side').style.display = 'block';
            document.getElementById('wordInput').focus();
        }

        function checkInput(e) {
            if (e.target.value.toLowerCase().trim() === currentPool[index].en.toLowerCase()) {
                e.target.classList.add('correct');
                document.getElementById('next-btn').style.display = 'block';
                speak('en-GB');
            }
        }

        function handleNext() {
            const currentWord = currentPool[index].en;
            
            if (hasLooked) {
                // çœ‹äº†ç­”æ¡ˆï¼Œè¿›é”™é¢˜æœ¬ï¼Œä¸”è®°å¿†ç­‰çº§é‡ç½®
                if (!wrongWords.find(w => w.en === currentWord)) wrongWords.push(currentPool[index]);
                wordProgress[currentWord].level = 0;
            } else {
                // æ²¡çœ‹ç­”æ¡ˆç›´æ¥æ‹¼å¯¹ï¼Œè®°å¿†ç­‰çº§+1
                wordProgress[currentWord].level += 1;
                wordProgress[currentWord].lastDate = Date.now();
            }
            
            localStorage.setItem('gem_word_v1', JSON.stringify(wordProgress));

            index++;
            if (index >= currentPool.length) {
                if (wrongWords.length > 0) {
                    alert("ç¬¬ä¸€è½®ç»“æŸï¼Œç°åœ¨å¤ä¹ åˆšæ‰çœ‹æç¤ºçš„å•è¯ã€‚");
                    currentPool = [...wrongWords];
                    wrongWords = [];
                    index = 0;
                } else {
                    alert("ğŸ‰ ä»Šå¤©çš„å­¦ä¹ ä»»åŠ¡å®Œæˆï¼");
                    location.reload(); // åˆ·æ–°ä»¥æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åˆ°æœŸè¯æ±‡
                    return;
                }
            }
            render();
        }

        function speak(lang) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(currentPool[index].en);
            u.lang = lang; u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function render() {
            if (currentPool.length === 0) {
                document.body.innerHTML = "<h1>ğŸŒŸ ä»»åŠ¡å·²å…¨éƒ¨å®Œæˆï¼</h1><p>ä»Šå¤©æ²¡æœ‰éœ€è¦å¤ä¹ çš„è¯äº†ï¼Œæ˜å¤©å†æ¥å§ã€‚</p>";
                return;
            }
            const item = currentPool[index];
            hasLooked = false;
            document.getElementById('progress-tag').innerHTML = `ä»Šæ—¥ä»»åŠ¡å‰©: ${currentPool.length - index} ä¸ª<br>å¾…å¤ä¹ æ”’äº†: ${wrongWords.length} ä¸ª`;
            document.getElementById('icon-display').innerText = item.icon;
            document.getElementById('cn-display').innerText = item.cn;
            document.getElementById('word-hint').innerText = item.en[0] + " _ ".repeat(item.en.length - 2) + item.en.slice(-1);
            document.getElementById('wordInput').value = "";
            document.getElementById('wordInput').classList.remove('correct');
            document.getElementById('front-side').style.display = 'block';
            document.getElementById('back-side').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            lock();
        }

        window.onload = render;
    </script>
</body>
</html>

